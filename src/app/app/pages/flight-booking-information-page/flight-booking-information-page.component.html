<app-common-modal-loading *ngIf="bookingLoading"></app-common-modal-loading>

<div id="wrap" class="p-flight-booking-information-page">
    <!-- header -->
    <app-flight-header [headerType]="headerType" [headerConfig]="headerConfig"></app-flight-header>

    <!-- contents -->
    <div id="contents" *ngIf="loadingBool">
        <div class="page-contents-type2">
            <form [formGroup]="travelerForm" (ngSubmit)="onSubmit()" novalidate #f="ngForm">

                <div class="contents-item">
                    <h2 class="contents-title">예약 정보 확인</h2>
                    <div class="round-box">
                        <div class="traveler-reserved-information">
                            <div class="item-group">
                                <div *ngFor="let item of selectedList; index as index;" [ngClass]="{'border-dashed-top grey mt20 pt20': index > 0}"  class="item-row">
                                    <div class="flight-reserved-item">

                                        <div class="item-top">
                                            <img src="/assets/images/airlines/{{ item.marketingAirlineCode }}_Small.png" alt="" class="airline-logo">
                                            <strong>{{ item.marketingAirlineNameLn }} {{ item.marketingAirlineCode }}{{ item.marketingflightNo }}</strong>
                                            <span class="code-share" *ngIf="item.operating">{{ item.operatingAirlineNameLn }} 실제 운항사</span>
                                        </div>
                                        <div class="item-middle">
                                            <div class="schedule">
                                                <div class="schedule-wrap">
                                                    <div class="time">
                                                        <p>{{ item.originDate | date : 'MM.dd' }}</p>
                                                        <p><strong>{{ item.originTime }}</strong></p>
                                                        <p>{{ item.originAirportCode }}</p>
                                                    </div>
                                                    <!-- 경유 1회는 .lay-over에 .over1 추가, 경유 2회는 .over2 추가 -->
                                                    <div class="lay-over" [ngClass]="{over1:item.stopsSimple==='1', over2:item.stopsSimple==='2' }">
                                                        <p>{{ item.stops }}</p>
                                                        <div class="line"></div>
                                                        <p>{{ item.flyingMinutes | flightMinuteToHourMinute}}</p>
                                                    </div>
                                                    <div class="time">
                                                        <p>{{ item.destinationDate | date : 'MM.dd' }}</p>
                                                        <p><strong>{{ item.destinationTime }}</strong></p>
                                                        <p>{{ item.destinationAirportCode }}</p>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>

                                    </div>
                                </div>
                            </div>

                            <div class="item-group mt20">
                                <div class="item-row">
                                    <a (click)="onSchedule()" class="btn lg default">항공 일정</a>
                                </div>
                            </div>

                            <div class="item-group mt30">

                                <ng-container>
                                    <div *ngIf="false" class="item-row col">
                                        <div class="left">항공요금*{{ howMany }}</div>
                                        <div class="right">원</div>
                                    </div>
                                    <div *ngIf="false" class="item-row col">
                                        <div class="left">세금 및 기타수수료*{{ howMany }}</div>
                                        <div class="right">원</div>
                                    </div>
                                    <div *ngIf="false" class="item-row col">
                                        <div class="left">유류할증료*{{ howMany }}</div>
                                        <div class="right">원</div>
                                    </div>
                                    <div *ngIf="false" class="item-row col">
                                        <div class="left">제세공과금*{{ howMany }}</div>
                                        <div class="right">원</div>
                                    </div>
                                    <div *ngIf="false" class="item-row col">
                                        <div class="left">수수료*{{ howMany }}</div>
                                        <div class="right">원</div>
                                    </div>
                                </ng-container>

                                <div class="item-row col last">
                                    <div class="left">
                                        <a (click)="onPayDetail()" class="text-link">
                                            <span class="text">총 결제금액</span>
                                            <span class="icon sm information3"></span>
                                        </a>
                                    </div>
                                    <div class="right"> {{ amountSum | number }}원</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="contents-item">
                    <h2 class="contents-title line">예약자 정보를 입력해 주세요.</h2>
                    <h3 class="contents-sub-text">예약과 관련된 중요사항을 연락처로 발송해 드립니다.</h3>
                    <div class="round-box">
                        <div class="row-group">
                            <div class="row mt0">
                                <h5 class="row-title">예약자 명</h5>
                                <div class="input line">
                                    <input #nameInput id="userName" formControlName="userName" [class.valid-error]="isValidError(travelerForm.controls.userName)" type="text" placeholder="한글 이름" readonly>
                                    <ng-container *ngIf="travelerForm.controls.userName.errors">
                                        <span *ngIf="travelerForm.controls.userName.errors.required" class="valid-msg">예약자 명은 필수값입니다.</span>
                                        <span *ngIf="travelerForm.controls.userName.errors.invalidMsg" class="valid-msg">{{travelerForm.controls.userName.errors.invalidMsg}}</span>
                                    </ng-container>
                                </div>
                            </div>
                            <div class="row">
                                <h5 class="row-title">휴대폰 번호</h5>
                                <div class="input line">
                                    <input #phoneInput id="mobileNo" maxlength="11" formControlName="mobileNo" [numOnly]="travelerForm.controls.mobileNo" [class.valid-error]="isValidError(travelerForm.controls.mobileNo)" type="tel" placeholder="'-' 제외하고 입력">
                                    <a (click)="userInfoReset($event, 2)" class=" icon sm input-delete2">삭제</a>
                                    <ng-container *ngIf="travelerForm.controls.mobileNo.errors">
                                        <span *ngIf="travelerForm.controls.mobileNo.errors.required" class="valid-msg">휴대폰 번호는 10자리 이상으로 입력해야 합니다.</span>
                                        <span *ngIf="travelerForm.controls.mobileNo.errors.minlength" class="valid-msg">휴대폰 번호는 10자리 이상으로 입력해야 합니다.</span>
                                        <span *ngIf="travelerForm.controls.mobileNo.errors.invalidMsg" class="valid-msg">{{travelerForm.controls.mobileNo.errors.invalidMsg}}</span>
                                    </ng-container>
                                </div>
                            </div>
                            <div class="row">
                                <h5 class="row-title">이메일</h5>
                                <div class="input line">
                                    <input #emailInput id="email" formControlName="email" [class.valid-error]="isValidError(travelerForm.controls.email)" type="email" placeholder="example@mail.com">
                                    <a (click)="userInfoReset($event, 3)" class="icon sm input-delete2">삭제</a>
                                    <ng-container *ngIf="travelerForm.controls.email.errors">
                                        <span *ngIf="travelerForm.controls.email.errors.required" class="valid-msg">이메일
                                            주소는 필수값입니다.</span>
                                        <span *ngIf="travelerForm.controls.email.errors.email" class="valid-msg">이메일 정보를 정확히 확인해주세요.</span>
                                    </ng-container>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="contents-item">
                    <h2 class="contents-title line">탑승자 정보를 입력해 주세요.</h2>
                    <h3 class="contents-sub-text">여권상의 영문 성, 영문 이름과 같지 않으면 탑승이 거부되거나 서비스를 이용할 수 없습니다.</h3>

                    <!-- 1번 탑승자는 고정, 2번 탑승자부터 인원수에 따라 증가 -->
                    <div formArrayName="travelers">
                        <ng-container *ngFor="let travelerItem of travelers.controls; index as i">
                            <ng-container [formGroupName]="i">
                                <div class="round-box">
                                    <h4 class="contents-title2 line2">{{i+1}}번째 탑승자
                                        <!-- <label *ngIf="i===0" class="checkbox small font-md rtl">
                                            <input type="checkbox" class="checkbox-control-input">
                                            <span class="checkbox-control-text">탑승자와 실제 예약자가 다름</span>
                                        </label> -->
                                        <span> {{travlerArray[i]}}</span>
                                    </h4>
                                    <div class="row-group">
                                        <div class="row">
                                            <h5 class="row-title">여행자 선택</h5>
                                            <div class="select-box line">
                                                <select formControlName="selectTravelers" (change)="onSelectTravelers($event, i)">
                                                    <option value="" selected>신규 여행자를 추가합니다 - 새로운 여행자를 입력합니다</option>
                                                    <option *ngFor="let item of traveler" [ngValue]="item" [hidden]="item.active">
                                                        {{item.name}} : {{item.lastName}} / {{item.firstName}}
                                                    </option>
                                                </select>
                                            </div>
                                        </div>
                                        <div *ngIf="isAssembleKoName;else elseKoName" class="row">
                                            <h5 class="row-title">한글 이름</h5>
                                            <div class="row col2 basis">
                                                <div class="input line">
                                                    <input id="lastNameLn{{i}}" [formControlName]="'lastNameLn'" [koOnly]="travelers.at(i).get('lastNameLn')" [class.valid-error]="isValidError(travelers.at(i).get('lastNameLn'))" type="text" placeholder="한글 성">
                                                    <ng-container *ngIf="travelers.at(i).get('lastNameLn').errors">
                                                        <span *ngIf="travelers.at(i).get('lastNameLn').errors.required" class="valid-msg">한글 성(은) 필수값입니다.</span>
                                                        <span *ngIf="travelers.at(i).get('lastNameLn').errors.maxlength" class="valid-msg">한글 성의 글자수는 16자 까지 입력 가능합니다</span>
                                                        <span *ngIf="travelers.at(i).get('lastNameLn').errors.invalidMsg" class="valid-msg">{{travelers.at(i).get('lastNameLn').errors.invalidMsg}}</span>
                                                    </ng-container>
                                                </div>
                                                <div class="input line">
                                                    <input id="firstNameLn{{i}}" [formControlName]="'firstNameLn'" [koOnly]="travelers.at(i).get('firstNameLn')" [class.valid-error]="isValidError(travelers.at(i).get('firstNameLn'))" type="text" placeholder="한글 이름">
                                                    <ng-container *ngIf="travelers.at(i).get('firstNameLn').errors">
                                                        <span *ngIf="travelers.at(i).get('firstNameLn').errors.required" class="valid-msg">한글 이름(은) 필수값입니다.</span>
                                                        <span *ngIf="travelers.at(i).get('firstNameLn').errors.maxlength" class="valid-msg">한글 이름의 글자수는 16자 까지 입력
                                                            가능합니다.</span>
                                                        <span *ngIf="travelers.at(i).get('firstNameLn').errors.invalidMsg" class="valid-msg">{{travelers.at(i).get('firstNameLn').errors.invalidMsg}}</span>
                                                    </ng-container>
                                                </div>
                                            </div>
                                        </div>
                                        <ng-template #elseKoName>
                                            <div class="row">
                                                <h5 class="row-title">한글 이름</h5>
                                                <div class="input line">
                                                    <input id="name{{i}}" [formControlName]="'name'" [koOnly]="travelers.at(i).get('name')" [class.valid-error]="isValidError(travelers.at(i).get('name'))" type="text" placeholder="한글 이름 입력">
                                                    <ng-container *ngIf="travelers.at(i).get('name').errors">
                                                        <span *ngIf="travelers.at(i).get('name').errors.required" class="valid-msg">예약자 명은 필수값입니다.</span>
                                                        <span *ngIf="travelers.at(i).get('name').errors.maxlength" class="valid-msg">한글 이름의 글자수는 33자 까지 입력 가능합니다.</span>
                                                        <span *ngIf="travelers.at(i).get('name').errors.invalidMsg" class="valid-msg">{{travelers.at(i).get('name').errors.invalidMsg}}</span>
                                                    </ng-container>
                                                </div>
                                            </div>
                                        </ng-template>
                                        <div class="row">
                                            <h5 class="row-title">영문 성/이름</h5>
                                            <div class="row col2 basis">
                                                <div class="input line">
                                                    <input id="lastName{{i}}" [formControlName]="'lastName'" type="text" placeholder="영문 성" [enOnly]="travelers.at(i).get('lastName')" [class.valid-error]="isValidError(travelers.at(i).get('lastName'))" oninput="this.value = this.value.toUpperCase()">
                                                    <ng-container *ngIf="travelers.at(i).get('lastName').errors">
                                                        <span *ngIf="travelers.at(i).get('lastName').errors.required" class="valid-msg">영문 성(은) 필수값입니다.</span>
                                                        <span *ngIf="travelers.at(i).get('lastName').errors.maxlength" class="valid-msg">영문 성의 글자수는 50자 까지 입력 가능합니다</span>
                                                        <span *ngIf="travelers.at(i).get('lastName').errors.invalidMsg" class="valid-msg">{{travelers.at(i).get('lastName').errors.invalidMsg}}</span>
                                                    </ng-container>
                                                </div>
                                                <div class="input line">
                                                    <input id="firstName{{i}}" [formControlName]="'firstName'" type="text" placeholder="영문 이름" [enOnly]="travelers.at(i).get('firstName')" [class.valid-error]="isValidError(travelers.at(i).get('firstName'))" oninput="this.value = this.value.toUpperCase()">
                                                    <ng-container *ngIf="travelers.at(i).get('firstName').errors">
                                                        <span *ngIf="travelers.at(i).get('firstName').errors.required" class="valid-msg">영문 이름(은) 필수값입니다.</span>
                                                        <span *ngIf="travelers.at(i).get('firstName').errors.maxlength" class="valid-msg">영문 이름의 글자수는 50자 까지 입력
                                                            가능합니다.</span>
                                                        <span *ngIf="travelers.at(i).get('firstName').errors.invalidMsg" class="valid-msg">{{travelers.at(i).get('firstName').errors.invalidMsg}}</span>
                                                    </ng-container>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="row">
                                            <h5 class="row-title">생년월일</h5>
                                            <div class="row">
                                                <div class="input line">
                                                    <input id="birthDay{{i}}" type="text" placeholder="생년월일 입력(8자리)" maxlength="8" [formControlName]="'birthDay'" [numOnly]="travelers.at(i).get('birthDay')" [class.valid-error]="isValidError(travelers.at(i).get('birthDay'))">
                                                    <ng-container *ngIf="travelers.at(i).get('birthDay').errors">
                                                        <span *ngIf="travelers.at(i).get('birthDay').errors.required" class="valid-msg">생년월일은 필수값입니다.</span>
                                                        <span *ngIf="travelers.at(i).get('birthDay').errors.minlength" class="valid-msg">생년월일은 8자리(ex> 20001010) 입력해주세요.</span>
                                                        <span *ngIf="travelers.at(i).get('birthDay').errors.invalidMsg" class="valid-msg">{{travelers.at(i).get('birthDay').errors.invalidMsg}}</span>
                                                    </ng-container>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="row auto">
                                            <div class="row-title">성별선택</div>
                                            <div [attr.data-target]="'gender'+i">
                                                <label class="radio">
                                                    <input type="radio" value="M" formControlName="gender" class="radio-control-input">
                                                    <span class="radio-control-text">남성</span>
                                                </label>
                                                <label class="radio">
                                                    <input type="radio" value="F" formControlName="gender" class="radio-control-input">
                                                    <span class="radio-control-text">여성</span>
                                                </label>
                                            </div>
                                        </div>
                                        <div class="row">
                                            <h5 class="row-title">국적</h5>
                                            <div class="select-box line">
                                                <select id="nationalityCode{{i}}" formControlName="nationalityCode" [class.valid-error]="isValidError(travelers.at(i).get('nationalityCode'))">
                                                    <option value="KR">대한민국</option>
                                                </select>
                                            </div>
                                        </div>
                                    </div>

                                    <ng-container *ngIf="apisNeededYn">
                                        <h4 class="contents-title2 mt20 pt20 border-dashed-top grey">여권정보</h4>
                                        <div class="row-group">
                                            <div class="row">
                                                <h5 class="row-title">여권번호</h5>
                                                <div class="row">
                                                    <div class="input line">
                                                        <input id="passportNo{{i}}" formControlName="passportNo" [class.valid-error]="isValidError(travelers.at(i).get('passportNo'))" maxlength="10" type="text" placeholder="여권번호 입력">
                                                        <ng-container *ngIf="travelers.at(i).get('passportNo').errors">
                                                            <span *ngIf="travelers.at(i).get('passportNo').errors.required" class="valid-msg">여권번호는 필수값입니다.</span>
                                                            <span *ngIf="travelers.at(i).get('passportNo').errors.invalidMsg" class="valid-msg">{{travelers.at(i).get('passportNo').errors.invalidMsg}}</span>
                                                        </ng-container>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="row">
                                                <h5 class="row-title">여권만료일</h5>
                                                <div class="row">
                                                    <div class="input line">
                                                        <input id="expireDate{{i}}" formControlName="expireDate" [class.valid-error]="isValidError(travelers.at(i).get('expireDate'))" maxlength="8" type="text" placeholder="여권만료일 입력(8자리)">
                                                        <ng-container *ngIf="travelers.at(i).get('expireDate').errors">
                                                            <span *ngIf="travelers.at(i).get('expireDate').errors.required" class="valid-msg">여권만료일은 필수값입니다.</span>
                                                            <span *ngIf="travelers.at(i).get('expireDate').errors.invalidMsg" class="valid-msg">{{travelers.at(i).get('expireDate').errors.invalidMsg}}</span>
                                                        </ng-container>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="row">
                                                <h5 class="row-title">여권 발행국</h5>
                                                <div class="select-box line">
                                                    <select id="issueCountryCode{{i}}" formControlName="issueCountryCode" [class.valid-error]="isValidError(travelers.at(i).get('issueCountryCode'))">
                                                        <option value="KO">대한민국</option>
                                                    </select>
                                                </div>
                                            </div>
                                            <ul class="text-list mt20 pt20 border-dashed-top grey">
                                                <li class="none-pd">
                                                    <span class="color-sub6">※ 탑승자의 여권 정보를 직접 입력하거나, 촬영 또는 휴대폰에 저장된 여권 사진을 업로드하여 자동 입력할 수 있습니다.</span>
                                                </li>
                                                <li class="none-pd mt10">
                                                    <a href="#" class="text-list">
                                                        <span class="text underline color-sub6">여권사진 등록샘플</span>
                                                        <span class="icon sm information2"></span>
                                                    </a>
                                                </li>
                                            </ul>
                                            <div class="btn-group both mt20 pt20 border-dashed-top grey">
                                                <button class="btn lg grey" role="button">사진 앨범</button>
                                                <button class="btn lg dark" role="button">직접 촬영</button>
                                            </div>
                                        </div>
                                    </ng-container>
                                </div>
                            </ng-container>
                        </ng-container>
                    </div>
                </div>

                <div class="contents-item">
                    <h2 class="contents-title line">요금, 취소수수료 규정을 확인하세요.</h2>
                    <h3 class="contents-sub-text">아래 규정 및 약관을 읽어보고, 동의하는 경우에 체크하고 최종 예약을 완료해 주세요.</h3>
                    <div class="round-box">
                        <!-- 체크박스 checked 될때마다 해당 모달을 띄움 -->
                        <ul class="row-group agree-row-group">
                            <li class="row line-bottom" data-target="agreeAllChk">
                                <label class="checkbox">
                                    <input type="checkbox" class="checkbox-control-input" (change)="onChangeAllAgreement($event)">
                                    <span class="checkbox-control-text">모든 약관에 동의합니다.</span>
                                </label>
                            </li>
                            <ng-container formArrayName="agreeList">
                                <li class="row agree-row">
                                    <label data-target="agreeChk" class="checkbox">
                                        <input formControlName="0" (change)="onChangeAgreement(0, $event)" type="checkbox" class="checkbox-control-input">
                                        <span class="checkbox-control-text"></span>
                                    </label>
                                    <span class="checkbox-text-area"><em (click)="onAgreementClick($event,'normal')">일반 규정</em>을 읽었으며 동의함</span>
                                </li>
                                <li class="row agree-row">
                                    <label data-target="agreeChk" class="checkbox">
                                        <input formControlName="1" (change)="onChangeAgreement(1, $event)" type="checkbox" class="checkbox-control-input">
                                        <span class="checkbox-control-text"></span>
                                    </label>
                                    <span class="checkbox-text-area"><em (click)="onAgreementClick($event,'cancel')">요금/취소/환불 규정</em>을 읽었으며 동의함</span>
                                </li>
                                <li class="row agree-row">
                                    <label data-target="agreeChk" class="checkbox">
                                        <input formControlName="2" (change)="onChangeAgreement(2, $event)" type="checkbox" class="checkbox-control-input">
                                        <span class="checkbox-control-text"></span>
                                    </label>
                                    <span class="checkbox-text-area"><em (click)="onAgreementClick($event,'personalInfo')">개인정보취급방침</em>을 읽었으며 동의함</span>
                                </li>
                            </ng-container>
                        </ul>
                    </div>
                    <div class="btn-group mt30">
                        <button class="btn lg default" role="button">최종 예약 완료</button>
                    </div>
                    <ul class="text-list mt20">
                        <li>예약 완료까지는 30초에서 2분가량 소요될 수 있습니다.</li>
                        <li>예약 완료 버튼은 1번만 클릭하시기 바라며 클릭 후에는 최종 완료될 때까지 기다려 주시기 바랍니다.</li>
                        <li>완료 전에 창을 닫으면 이중 결제 또는 예약 에러가 발생할 수 있습니다.</li>
                    </ul>
                </div>

            </form>
        </div>
    </div>
</div>